<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=0.95" />
  <title>Panel Calculator</title>

  <!-- CSS  -->
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
</head>
<style>
  html {
    line-height: 1.26;
  }

  .x {
    margin-left: 15px;
    margin-right: 15px;
    font-size: 30px;
  }

  .test {}

  .bends {
    /* border-bottom: 5px solid black; */
  }

  .blank {
    /* border-right: 5px solid black; */
    /* border-left: 5px solid black; */
    border-bottom: 5px solid black;
    /* border-top: 5px solid black; */
    margin-top: 12px;
    min-height: 200px;
  }

  .bend-1 {
    /* border-right: 3px solid black; */
    border-bottom: 5px solid black;
    border-left: 10px solid yellowgreen;
    /* border-bottom: 3px solid black; */
    margin-top: 18px;
    min-height: 200px;
  }

  .bend-2 {
    border-right: 10px solid yellowgreen;
    border-bottom: 5px solid black;
    border-left: 5px solid black;
    /* border-bottom: 3px solid black; */
    margin-top: 18px;
    min-height: 200px;
    /* width: 90%; */
  }

  .leg {
    font-size: 20px;
  }

  .input-label {
    font-size: 35px;
    ;
  }

  .label {
    font-size: 20px;
  }

  .label-value {
    font-size: 20px;
    ;
  }

  .value {
    /* font-size: 2.7vh; */
    font-size: 125px;
    color: #4CAF50;
  }

  .calc-value {
    font-size: 85px;
    min-height: 110px;
  }

  .calc-buttons {
    font-size: 35px;
    ;
  }

  .row {
    margin: 0px;
  }

  .btn-floating.btn-large {
    width: 80px;
    height: 80px;
    padding: 0;
    padding-top: 15px;
  }
</style>

<body>

  <!-- Modal Structure -->
  <div id="modal1" class="modal" style="top:30px;max-height:90%;">
    <div class="modal-content" style="padding-bottom: 0px;">
      <div class="row center" style="margin-bottom:0px;">
        <h3 id="value" class="blue-text text-darken-3 calc-value"></h3>
      </div>
      <div class="row center" style="font-size: 50px;font-weight: 700;">
        <span>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(7)">7</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(8)">8</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(9)">9</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a class=" btn-floating btn-large waves-effect waves-light orange"
            style="margin-bottom: 10px;font-size: 45px;" onclick="updateValue(4)">4</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(5)">5</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(6)">6</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a class=" btn-floating btn-large waves-effect waves-light orange"
            style="margin-bottom: 10px;font-size: 45px;" onclick="updateValue(1)">1</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(2)">2</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(3)">3</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a id="plusMinus" class=" btn-floating btn-large waves-effect waves-light orange"
            style="margin-bottom: 0px;font-size: 25px;" onclick="updateValue('-')">+/-</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(0)">0</a>
          <a class="btn-floating btn-large waves-effect waves-light orange" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue('.')">.</a>
        </span>
      </div>
    </div>
    <div class="modal-footer">
      <a class="waves-effect waves-green btn-flat calc-buttons left" onclick="updateValue('C')">Clear</a>
      <a class="modal-close waves-effect waves-green btn-flat calc-buttons" onclick="apply()">OK</a>
      <a class="modal-close waves-effect waves-green btn-flat calc-buttons">Cancel</a>
    </div>
  </div>









  <!-- FORM -->
  <div class="section no-pad-bot" id="index-banner">
    <div class="container" style="width:90%;">

      <div id="bends" class="row">

        <div class="row">
          <div class="col s12 l6 center" style="font-size:38px;">

            <!-- FINISH HEIGHT -->
            <div class="col s7 center">
              <div class="truncate input-label">Finish Height:</div>
            </div>
            <div class="col s3 center">
              <div id="height" class="blue-text text-darken-3">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('height')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- FINISH LENGTH -->
            <div class="col s7 center">
              <div class="truncate input-label">Finish Length:</div>
            </div>
            <div class="col s3 center" style="border:0px solid blue">
              <div id="length" class="blue-text text-darken-3">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('length')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <br />
          </div>

          <!-- FINISH DIMENSIONS -->
          <div class="col s12 l6 center" style="font-size:38px;">
            <!-- BLANK ACTUAL HEIGHT -->
            <div class="col s7 center">
              <div class="truncate input-label">Blank Short:</div>
            </div>
            <div class="col s3 center">
              <div id="blank-actual-height" class="blue-text text-darken-3">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('blank-actual-height')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- BLANK ACTUAL LENGTH -->
            <div class="col s7 center">
              <div class="truncate input-label">Blank Long:</div>
            </div>
            <div class="col s3 center">
              <div id="blank-actual-length" class="blue-text text-darken-3">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('blank-actual-length')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- BEND OFFSET -->
            <div class="col s7 center">
              <div class="truncate input-label">Bend Offset:</div>
            </div>
            <div class="col s3 center">
              <div id="bend-offset" class="blue-text text-darken-3">0.08
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('bend-offset')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>

          </div>
        </div>
        <hr />

        <!-- VALUES -->
        <div class="col s12 l6 center">
          <div class="col s12 center">
            <div class="label blank">Blank Target Short<br /><b class="green-text value" id="blank-target-height"></b>
            </div>
          </div>

          <div class="col s12 center bends">
            <div class="label-value bend-1">Short Bend 1<br /><b class="value" id="bend-height-1"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-2">Short Bend 2<br /><b class="value" id="bend-height-2"></b>
            </div>
          </div>
        </div>

        <div class="col s12 l6 center">
          <div class="col s12 center">
            <div class="label blank">Blank Target Long<br /><b class="green-text value" id="blank-target-length"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-1">Long Bend 1<br /><b class="value" id="bend-length-1"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-2">Long Bend 2<br /><b class="value" id="bend-length-2"></b>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>


  <!--  Scripts-->
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>

</body>
<script>
  // query params: ?bend-offset=0.08&blank-actual-height=17.5&blank-actual-length=70&height=15&length=47.5
  var elem = null;
  var field = null;
  document.addEventListener('DOMContentLoaded', function () {
    const urlSearchParams = new URLSearchParams(window.location.search);
    const params = Object.fromEntries(urlSearchParams.entries());
    if (Object.keys(params).length > 0) {
      Object.keys(params).forEach((p) => {
        document.getElementById(p).innerHTML = +(params[p]);
      })
      calculate()
    }

    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, {});
    elem = elems[0];
  });
  function openModal(x) {
    field = x;
    var v = document.getElementById(field).innerHTML.trim()
    document.getElementById("value").innerHTML = +(v) === 0 ? '' : v;
    var instance = M.Modal.getInstance(elem);
    if (field == 'bend-offset') {
      document.getElementById("plusMinus").removeAttribute('disabled');
    } else {
      document.getElementById("plusMinus").setAttribute('disabled', false);
    }
    instance.open();
  }
  function updateValue(x) {
    setTimeout(() => {
      var e = document.getElementById("value");
      if (x == 'C') {
        e.innerHTML = "";
      } else if (x == '-') {
        let v = e.innerHTML;
        if (v.startsWith(x)) {
          v = v.substr(1);
        } else {
          v = x + v;
        }
        e.innerHTML = v;
      } else {
        e.innerHTML += x;
      }
    }, 1)
  }
  function apply() {
    var v = +(document.getElementById("value").innerHTML);
    document.getElementById(field).innerHTML = v;
    if (field == 'height' || field == 'length') {
      var bv = v + (1.187 * 2);
      if (v > 0) {
        document.getElementById("blank-target-" + field).innerHTML = Round(bv, 3);
        if (field == 'height') {
          document.getElementById("blank-actual-height").innerHTML = '';
        }
        if (field == 'length') {
          document.getElementById("blank-actual-length").innerHTML = '';
        }
      }
    }
    calculate();
  }
  function calculate() {
    var requestedHeight = +(document.getElementById("height").innerHTML);
    var requestedLength = +(document.getElementById("length").innerHTML);
    var targetHeight = requestedHeight + (1.187 * 2);
    var targetLength = requestedLength + (1.187 * 2);
    var bendOffset = +(document.getElementById("bend-offset").innerHTML);
    var bendActualHeight = +(document.getElementById("blank-actual-height").innerHTML);
    var bendActualLength = +(document.getElementById("blank-actual-length").innerHTML);
    var heightLeg = (bendActualHeight - requestedHeight - bendOffset) / 2;
    var lengthLeg = (bendActualLength - requestedLength - bendOffset) / 2;
    if (bendActualHeight > 0 && requestedHeight > 0) {
      document.getElementById("blank-target-height").innerHTML = Round(targetHeight, 3);
      var v1 = Round(bendActualHeight - heightLeg - bendOffset, 3);
      document.getElementById("bend-height-1").innerHTML = v1;
      document.getElementById("bend-height-2").innerHTML = Round(v1 - heightLeg - bendOffset, 3);
    } else {
      document.getElementById("bend-height-1").innerHTML = '';
      document.getElementById("bend-height-2").innerHTML = '';
    }
    if (bendActualLength > 0 && requestedLength > 0) {
      document.getElementById("blank-target-length").innerHTML = Round(targetLength, 3);
      var v2 = Round(bendActualLength - lengthLeg - bendOffset, 3);
      document.getElementById("bend-length-1").innerHTML = v2;
      document.getElementById("bend-length-2").innerHTML = Round(v2 - lengthLeg - bendOffset, 3);
    } else {
      document.getElementById("bend-length-1").innerHTML = '';
      document.getElementById("bend-length-2").innerHTML = '';
    }
  }
  function Round(value, decimals = 0) {
    if (typeof value === 'number') {
      return Number(Math.round(+(value + 'e' + decimals)) + 'e-' + decimals).toFixed(decimals);
    } else {
      return value; // handles null being provided
    }
  }
</script>

</html>