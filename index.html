<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Panel Calculator</title>

  <!-- CSS  -->
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection" />
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection" />
</head>
<style>
  html {
    line-height: 1.26;
    background-color: black;
    color: white;
  }

  .modal {
    /* line-height: 1.26; */
    background-color: black;
    color: white;
  }

  .x {
    margin-left: 15px;
    margin-right: 15px;
    font-size: 30px;
  }

  .test {}

  .bends {
    /* border-bottom: 5px solid black; */
  }

  .blank {
    /* border-right: 5px solid black; */
    /* border-left: 5px solid black; */
    border-bottom: 5px solid white;
    /* border-top: 5px solid black; */
    margin-top: 12px;
    min-height: 200px;
  }

  .blank-box {
    border-right: 5px solid white;
    border-left: 5px solid white;
    border-bottom: 5px solid white;
    border-top: 5px solid white;
    /* margin-top: 12px; */
    height: 50px;
  }

  .bend-1 {
    /* border-right: 3px solid black; */
    border-bottom: 5px solid white;
    border-left: 10px solid #04ff0c;
    /* border-bottom: 3px solid black; */
    margin-top: 18px;
    min-height: 200px;
  }

  .bend-2 {
    border-right: 10px solid #04ff0c;
    border-bottom: 5px solid white;
    border-left: 5px solid white;
    /* border-bottom: 3px solid black; */
    margin-top: 18px;
    min-height: 200px;
    /* width: 90%; */
  }

  .leg {
    font-size: 20px;
    color: #04ff0c;
  }

  .input {
    color: rgb(0, 195, 255);
    font-weight: 700;
  }

  .input-label {
    font-size: 35px;
    ;
  }

  .label {
    font-size: 20px;
  }

  .label-value {
    font-size: 20px;
    ;
  }

  .value {
    /* font-size: 2.7vh; */
    font-size: 125px;
    color: #04ff0c;
  }

  .calc-value {
    font-size: 85px;
    min-height: 110px;
    color: rgb(0, 195, 255);
  }

  .calc-buttons {
    font-size: 75px;
    ;
  }

  .calc-actions {
    font-size: 45px;
    min-width: 140px;
  }

  .row {
    margin: 0px;
  }

  .btn-floating.btn-large {
    width: 120px;
    height: 120px;
    padding: 0;
    padding-top: 30px;
    margin-bottom: 10px;
    font-size: 45px;
  }

  .modal .modal-footer {
    height: 85px;
    /* background-color: black;
    color: white; */
  }

  .btn {
    min-width: 80px;
    min-height: 40px;
  }
</style>

<body>

  <!-- Modal Structure -->
  <div id="modal1" class="modal" style="top:30px;max-height:90%;">
    <div class="modal-content" style="padding-bottom: 0px;">
      <div class="row center" style="margin-bottom:0px;">
        <h3 id="value" class="calc-value"></h3>
      </div>
      <div class="row center" style="font-size: 50px;font-weight: 700;">
        <span>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(7)">7</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(8)">8</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(9)">9</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a class=" btn-floating btn-large orange calc-buttons" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(4)">4</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(5)">5</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(6)">6</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a class=" btn-floating btn-large orange calc-buttons" style="margin-bottom: 10px;font-size: 45px;"
            onclick="updateValue(1)">1</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(2)">2</a>
          <a class="btn-floating btn-large orange orange calc-buttons" onclick="updateValue(3)">3</a>
        </span>
        <br>
        <span style="margin-top:5px;">
          <a id="plusMinus" class=" btn-floating btn-large orange calc-buttons" style="margin-bottom: 0px;font-size: 40px;"
            onclick="updateValue('-')">+/-</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue(0)">0</a>
          <a class="btn-floating btn-large orange calc-buttons" onclick="updateValue('.')">.</a>
        </span>
      </div>
    </div>
    <br />
    <div class="modal-footer">
      <a class="waves-effect waves-green btn-flat btn-large calc-actions left" onclick="updateValue('C')">Clear</a>
      <a class="modal-close waves-effect waves-green btn-flat btn-large calc-actions" onclick="apply()">OK</a>
      <a class="modal-close waves-effect waves-green btn-flat btn-large calc-actions">Cancel</a>
    </div>
  </div>









  <!-- FORM -->
  <br />
  <div class="section no-pad-bot" id="index-banner">
    <div class="container" style="width:90%;">

      <div id="bends" class="row">

        <div class="row">
          <div class="col s12 m6 center" style="font-size:38px;">

            <!-- FINISH HEIGHT -->
            <div class="col s7 center">
              <div class="truncate input-label">Finish Short:</div>
            </div>
            <div class="col s3 center">
              <div id="height" class="input">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('height')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- FINISH LENGTH -->
            <div class="col s7 center">
              <div class="truncate input-label">Finish Long:</div>
            </div>
            <div class="col s3 center" style="border:0px solid blue">
              <div id="length" class="input">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('length')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- <br /> -->
            <!-- FINISH LENGTH -->
            <div class="col s7 center">
              <div class="truncate input-label">Leg Length:</div>
            </div>
            <div class="col s3 center" style="border:0px solid blue">
              <div id="leg" class="input">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('leg')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
          </div>

          <!-- FINISH DIMENSIONS -->
          <div class="col s12 m6 center" style="font-size:38px;">
            <!-- BLANK ACTUAL HEIGHT -->
            <div class="col s7 center">
              <div class="truncate input-label">Short Actual:</div>
            </div>
            <div class="col s3 center">
              <div id="blank-actual-height" class="input">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('blank-actual-height')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- BLANK ACTUAL LENGTH -->
            <div class="col s7 center">
              <div class="truncate input-label">Long Actual:</div>
            </div>
            <div class="col s3 center">
              <div id="blank-actual-length" class="input">
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('blank-actual-length')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>
            <!-- BEND OFFSET -->
            <div class="col s7 center">
              <div class="truncate input-label">Bend Offset:</div>
            </div>
            <div class="col s3 center">
              <div id="bend-offset" class="input">0.08
              </div>
            </div>
            <div class="col s1 center" onclick="openModal('bend-offset')">
              <div class="btn waves-effect waves-light orange" style="margin-top:-8px;">
                <img src="images/edit.png" style="height:28px;margin-top:3px;" />
              </div>
            </div>

          </div>
        </div>
        <hr />

        <!-- VALUES -->
        <div class="col s12 l6 center">
          <div class="col s12 center">
            <div class="label blank">Blank Target Short<br />
              <div>Leg: <b id="leg-height" class="leg"></b></div>
              <b class="value" id="blank-target-height"></b>
            </div>
          </div>

          <div class="col s12 center bends">
            <div class="label-value bend-1">Short Bend 1<br /><b class="value" id="bend-height-1"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-2">Short Bend 2<br /><b class="value" id="bend-height-2"></b>
            </div>
          </div>
        </div>

        <div class="col s12 l6 center">
          <div class="col s12 center">
            <div class="label blank">Blank Target Long<br />
              <div>Leg: <b id="leg-length" class="leg"></b></div>
              <b class="value" id="blank-target-length"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-1">Long Bend 1<br /><b class="value" id="bend-length-1"></b>
            </div>
          </div>
          <div class="col s12 center bends">
            <div class="label-value bend-2">Long Bend 2<br /><b class="value" id="bend-length-2"></b>
            </div>
          </div>
        </div>

      </div>

    </div>
    <!-- 123
    <div id="outerWidth"></div>
    <div id="outerHeight"></div> -->
  </div>


  <!--  Scripts-->
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>

</body>
<script>
  // query params: ?bend-offset=0.08&blank-actual-height=17.5&blank-actual-length=70&height=15&length=47.5
  var w = window.outerWidth;
  var h = window.outerHeight;
  var elem = null;
  var field = null;
  var minLeg = 0.5;
  var maxLeg = 2;
  var elemValue = null;
  window.addEventListener('resize', function () {
    setValuefontSize(this);
  });
  document.addEventListener('DOMContentLoaded', function () {
    // alert(w + ',' + h);
    const urlSearchParams = new URLSearchParams(window.location.search);
    const params = Object.fromEntries(urlSearchParams.entries());
    if (Object.keys(params).length > 0) {
      Object.keys(params).forEach((p) => {
        if (p == 'minLeg') {
          minLeg = +(params[p]);
        } else if (p == 'maxLeg') {
          maxLeg = +(params[p]);
        } else {
          document.getElementById(p).innerHTML = +(params[p]);
        }
      })
      calculate();
      elemValue = document.getElementById('value');
      // document.getElementById('outerWidth').innerHTML = w;
      // document.getElementById('outerHeight').innerHTML = h;
    }

    var elems = document.querySelectorAll('.modal');
    var instances = M.Modal.init(elems, {});
    elem = elems[0];
  });
  function openModal(x) {
    field = x;
    var v = document.getElementById(field).innerHTML.trim()
    document.getElementById("value").innerHTML = +(v) === 0 ? '' : v;
    // elemValue.innerHTML = +(v) === 0 ? '' : v;
    var instance = M.Modal.getInstance(elem);
    if (field == 'bend-offset') {
      document.getElementById("plusMinus").removeAttribute('disabled');
    } else {
      document.getElementById("plusMinus").setAttribute('disabled', false);
    }
    instance.open();
  }
  function updateValue(x) {
    // setTimeout(() => {
    var e = document.getElementById("value");
    // var e = elemValue;
    if (x == 'C') {
      e.innerHTML = "";
    } else if (x == '-') {
      let v = e.innerHTML;
      if (v.startsWith(x)) {
        v = v.substr(1);
      } else {
        v = x + v;
      }
      e.innerHTML = v;
    } else {
      e.innerHTML += x;
    }
    // }, 1)
  }
  function apply() {
    var v = +(document.getElementById("value").innerHTML);
    var leg = +(document.getElementById("leg").innerHTML);
    document.getElementById(field).innerHTML = v;
    if (field == 'height' || field == 'length') {
      var blankSize = v + (leg * 2);
      if (v > 0) {
        document.getElementById("blank-target-" + field).innerHTML = Round(blankSize, 3);
        if (field == 'height') {
          document.getElementById("blank-actual-height").innerHTML = '';
        }
        if (field == 'length') {
          document.getElementById("blank-actual-length").innerHTML = '';
        }
      }
    }
    calculate();
  }
  function calculate() {
    var leg = +(document.getElementById("leg").innerHTML);
    var requestedHeight = +(document.getElementById("height").innerHTML);
    var requestedLength = +(document.getElementById("length").innerHTML);
    var targetHeight = requestedHeight + (leg * 2);
    var targetLength = requestedLength + (leg * 2);
    var bendOffset = +(document.getElementById("bend-offset").innerHTML);
    var blankActualHeight = +(document.getElementById("blank-actual-height").innerHTML);
    var blackActualLength = +(document.getElementById("blank-actual-length").innerHTML);
    var heightLeg = blankActualHeight > 0 ? (blankActualHeight - requestedHeight - bendOffset) / 2 : (targetHeight - requestedHeight) / 2;
    var lengthLeg = blackActualLength > 0 ? (blackActualLength - requestedLength - bendOffset) / 2 : (targetLength - requestedLength) / 2;
    if (blankActualHeight > 0 && requestedHeight > 0) {
      document.getElementById("blank-target-height").innerHTML = Round(targetHeight, 3);
      var v1 = Round(blankActualHeight - heightLeg - bendOffset, 3);
      document.getElementById("bend-height-1").innerHTML = v1;
      document.getElementById("bend-height-2").innerHTML = Round(v1 - heightLeg - bendOffset, 3);
      document.getElementById("leg-height").innerHTML = Round(heightLeg, 3);
    } else {
      document.getElementById("bend-height-1").innerHTML = '';
      document.getElementById("bend-height-2").innerHTML = '';
      document.getElementById("leg-height").innerHTML = Round(heightLeg, 3);
    }
    if (blackActualLength > 0 && requestedLength > 0) {
      document.getElementById("blank-target-length").innerHTML = Round(targetLength, 3);
      var v2 = Round(blackActualLength - lengthLeg - bendOffset, 3);
      document.getElementById("bend-length-1").innerHTML = v2;
      document.getElementById("bend-length-2").innerHTML = Round(v2 - lengthLeg - bendOffset, 3);
      document.getElementById("leg-length").innerHTML = Round(lengthLeg, 3);
    } else {
      document.getElementById("bend-length-1").innerHTML = '';
      document.getElementById("bend-length-2").innerHTML = '';
      document.getElementById("leg-length").innerHTML = Round(lengthLeg, 3);;
    }
    // validate the leg length for height and length based on min and max
    document.getElementById("leg-height").style.color = heightLeg < minLeg || heightLeg > maxLeg ? 'red' : null;
    document.getElementById("blank-actual-height").style.backgroundColor = heightLeg < minLeg || heightLeg > maxLeg ? 'red' : null;
    document.getElementById("blank-actual-height").style.color = heightLeg < minLeg || heightLeg > maxLeg ? null : null;
    document.getElementById("leg-length").style.color = lengthLeg < minLeg || lengthLeg > maxLeg ? 'red' : null;
    document.getElementById("blank-actual-length").style.backgroundColor = lengthLeg < minLeg || lengthLeg > maxLeg ? 'red' : null;
    document.getElementById("blank-actual-length").style.color = lengthLeg < minLeg || lengthLeg > maxLeg ? 'white' : null;

    setValuefontSize(this);
  }
  /**
   * set the font size so that it is not too big on mobile
   */
  function setValuefontSize(e) {
    const h = window.innerHeight;
    const w = window.innerWidth;
    // console.log(h, w, e);
    var size = h > w ? '110px' : '125px';
    var elements = [];
    elements.push(document.getElementById("blank-target-height"));
    elements.push(document.getElementById("bend-height-1"));
    elements.push(document.getElementById("bend-height-2"));
    elements.push(document.getElementById("blank-target-length"));
    elements.push(document.getElementById("bend-length-1"));
    elements.push(document.getElementById("bend-length-2"));
    elements.forEach((e) => {
      e.style.fontSize = size;
      // e.style.minHeight = h > w ? '150px' : '200px';
    })
    elements = [];
    elements.push(...Array.from(document.getElementsByClassName('blank')));
    elements.push(...Array.from(document.getElementsByClassName('bend-1')));
    elements.push(...Array.from(document.getElementsByClassName('bend-2')));
    elements.forEach((e) => {
      e.style.minHeight = h > w ? '180px' : '200px';
    })

    var buttons = Array.from(document.getElementsByClassName("calc-buttons"));
    buttons.forEach((b) => {
      if (w < 500) {
        if (b.id == 'plusMinus') {
          b.style.fontSize = '30px';
        }
        b.style.width = '60px';
        b.style.height = '60px';
        b.style.paddingTop = '3px';
      } else {
        if (b.id !== 'plusMinus') {
          b.style.fontSize = h > w ? '50px' : '70px';
        }
        b.style.width = h > w ? '100px' : '120px';
        b.style.height = h > w ? '100px' : '120px';
        b.style.paddingTop = h > w ? '25px' : '30px';
      }
    })
  }
  function Round(value, decimals = 0) {
    if (typeof value === 'number') {
      return Number(Math.round(+(value + 'e' + decimals)) + 'e-' + decimals).toFixed(decimals);
    } else {
      return value; // handles null being provided
    }
  }
</script>

</html>